<!doctype html>
<html lang="zh-CN">

<head>
    <!-- 原始地址：//webapi.amap.com/ui/1.0/ui/misc/PoiPicker/examples/index.html -->
    <base href="//webapi.amap.com/ui/1.0/ui/misc/PoiPicker/examples/" />
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <title>输入框选择POI点</title>
    <style>
    html,
    body,
    #container {
        width: 100%;
        height: 100%;
        margin: 0px;
        font-size: 13px;
    }
    
    #pickerBox {
        position: absolute;
        z-index: 9999;
        top: 50px;
        right: 30px;
        width: 300px;
    }
    
    #pickerInput {
        width: 200px;
        padding: 5px 5px;
    }
    
    #poiInfo {
        background: #fff;
    }
    
    .amap_lib_placeSearch .poibox.highlight {
        background-color: #CAE1FF;
    }
    
    .amap_lib_placeSearch .poi-more {
        display: none!important;
    }
    </style>
</head>

<body>
    <div id="container" class="map" tabindex="0"></div>
    <div id="pickerBox">
        <input id="pickerInput" placeholder="输入关键字选取地点" />
        <div id="poiInfo"></div>
    </div>
    <script type="text/javascript" src='//webapi.amap.com/maps?v=1.3&key=c72c128531b240087fe95ff8ca5e44a1'></script>
    <!-- UI组件库 1.0 -->
    <script src="//webapi.amap.com/ui/1.0/main.js?v=1.0.10"></script>
    <script type="text/javascript">
    var map = new AMap.Map('container', {
        zoom: 10
    });

    AMapUI.loadUI(['misc/PoiPicker','overlay/SimpleInfoWindow'], function(PoiPicker,SimpleInfoWindow) {

        var poiPicker = new PoiPicker({
            //city:'北京',
            input: 'pickerInput'
        });

        //初始化poiPicker
        poiPickerReady(poiPicker,SimpleInfoWindow);
    });

    function poiPickerReady(poiPicker,SimpleInfoWindow) {

        window.poiPicker = poiPicker;

        var marker = new AMap.Marker({
            draggable: true,
            position: map.getCenter()
        });

        var _tml = '<div><input type="text" name="name"  id="name"placeholder="站点名称"></div>'+
                    '<div><input type="text" name="address" id="address" placeholder="站点地址"></div>'+
                    '<div><select name="stationType" id="stationType"><option>站点属性</option><option>上行</option><option>下行</option></select></div>'+
                    '<div><button>取消</button><button class="confirmBtn">确认</button></div>';
        var infoWindow = new SimpleInfoWindow({
            offset: new AMap.Pixel(0, -20),
            infoTitle:'新增站点',
            infoBody:_tml
        });

        marker.setMap(map);//设置拖拽默认点位置

        infoWindow.setMap(map);

        // var _tml = '<div><input type="text" name="name"  id="name"placeholder="站点名称"></div>'+
        //             '<div><input type="text" name="address" id="address" placeholder="站点地址"></div>'+
        //             '<div><select name="stationType" id="stationType"><option>站点属性</option><option>上行</option><option>下行</option></select></div>'+
        //             '<div><button>取消</button><button class="confirmBtn">确认</button></div>';
        // infoWindow.setContent(_tml);
       

        //选取了某个POI
        poiPicker.on('poiPicked', function(poiResult) {
            var source = poiResult.source,
                poi = poiResult.item,
                info = {
                    source: source,
                    id: poi.id,
                    name: poi.name,
                    location: poi.location.toString(),
                    address: poi.address
                };

            marker.setMap(map);
            
            //infoWindow.setPosition(poi.location);
            marker.setPosition(poi.location);

             //infoWindow.open(map, marker.getPosition());
            //map.setCenter(marker.getPosition());
        });

        poiPicker.onCityReady(function() {
            poiPicker.suggest('美食');
        });

        AMap.event.addListener(marker, 'click', function() {//点击时，显示弹出窗体
            infoWindow.open(map, marker.getPosition());
        });

        AMap.event.addListener(marker, 'dragstart', function() {//拖拽时移除弹出窗体
            infoWindow.close();
        });


        infoWindow.get$InfoBody().on('click', '.confirmBtn', function(event) {

            //阻止冒泡
            event.stopPropagation();
            var _name = $("#name").val()
            var _address = $("#address").val()
            var _stationType =  $("#stationType").val()
            if(_name!=''&&_address!=''&&_stationType!='' &&_stationType!='站点属性'){
                var _params = {
                 'name':_name,
                     'address':_address,
                     'stationType':_stationType,
                     'gps':marker.getPosition(),
                     "secondCompanyID":'12',
                 "schedulerID":'22'
                }
                schedulerHttpService.addSite(_params).then(function(result){

                })
            }else{
             alertify.alert('请输入必填项');
             //alert(_name+"x"+_address+"x"+_stationType)
            }
        });
    }
    </script>
</body>

</html>